# 微信订阅号开发的一些坑

## 问题1
 服务上线，配置都调好的情况下，在微信后台启用开发者模式后，一直没有收到微信推送的消息。
首页我先在微信后台重新保存了一下配置，等了一会还是没收到。
继续尝试用另外一个订阅号开启服务，结果刚开启收到了消息，以为是原订阅号有问题
仔细发现是原订阅号的消息，而刚启用的订阅号地址配到了测试环境（线上排查，不够冷静）

结论：暂时认定微信消息服务器的启用应该存在一定的延时，可能会在几分钟到十几分钟
但是测试号没有这样的问题，后续继续观察吧

## 问题2
 微信服务器的白名单：获取各类型token都要添加各自的白名单，各不相同，需要看日志配置

## 问题3
线上服务用户发现报错，是一个数据重复的问题，而且报错没有catch，进行口语化提示
分析原因：查询数据发现，数据一样，包括创建时间，初步分析用户在网络不好的情况下，导致重复请求，插入两条数据
改进：暂时数据库加唯一键，后期分析一下加锁的各种类型和适用场景

## 总结
1. 上线发布，总会出现各类问题，需要冷静对待，跟踪详细日志排除问题
2. 需要改进：分布式集群服务日志收集需要跟进，日志埋点和级别需要统一和全面
